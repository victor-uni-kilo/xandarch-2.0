import React, { createContext, FC, ReactNode, useState } from "react";
import { useRouter } from "next/router";

import GridLines from "../GridLines/GridLines";
import { PAGE_LINKS, DASHBOARD_LINKS } from "../../constants/maps";
import Head from "next/head";
import { IPagesMap, LayoutContext } from "types";

import styles from "./Layout.module.scss";
import Navbar from "../Navbar/Navbar";

import { SITE_AREA } from "types";

interface ILayoutProps {
  children: ReactNode;
}

export const PageLayoutContext = createContext<LayoutContext>(null);

const Layout: FC<ILayoutProps> = ({ children }) => {
  const [dynamicPageTitle, setDynamicPageTitle] = useState("");

  const router = useRouter();
  const currentRoute = router.pathname;

  const cmsPath = new RegExp("/dashboard");
  const siteArea = cmsPath.test(currentRoute) ? SITE_AREA.cms : SITE_AREA.presentation;

  const is404 = /\/404/.test(currentRoute);
  const isDynamicRoute = /\[/.test(currentRoute);

  const findPageTitle = (pageMap: IPagesMap[], route: string) => {
    console.log(pageMap, route);

    return pageMap.find(pageProps => pageProps.href === route)?.text;
  };
  console.log("pageTitle", findPageTitle(PAGE_LINKS, currentRoute));

  let pageTitle;

  switch (is404) {
    case true:
      pageTitle = "Not Found";
      break;
    default:
      switch (isDynamicRoute) {
        case true:
          pageTitle = dynamicPageTitle;
          break;
        default:
          switch (siteArea) {
            case SITE_AREA.presentation:
              pageTitle = findPageTitle(PAGE_LINKS, currentRoute);
              break;
            case SITE_AREA.cms:
              pageTitle = findPageTitle(DASHBOARD_LINKS, currentRoute);
              break;
            default:
              console.log("Catch all this");
              break;
          }
          break;
      }
      break;
  }

  const queryArray = currentRoute.split("/");

  console.log("queryArray", queryArray);

  console.log("currentRoute", currentRoute);
  console.log("routerQuery", JSON.stringify(router.query));

  //[domain][node][node][node][node]

  //[domain]sitearea/node/node/[node]/

  console.log("router", router);
  console.log("is404", is404);

  const getPageTitle = () => {
    let pageTitle = "NotWorking";
    if (siteArea === "presentation") {
      if (isDynamicRoute) {
        pageTitle = dynamicPageTitle;
      } else {
        PAGE_LINKS.find(pageProps => {
          if (pageProps.href === currentRoute) {
            pageTitle = pageProps.text;
          }
        });
      }
    } else if (siteArea === "cms") {
      pageTitle = "CMS";
    } else {
      pageTitle = "404";
    }
    return pageTitle;
  };
  // const getPageTitle = () => {
  //   PAGE_LINKS.find(pageProps => {
  //     if (pageProps.href === currentRoute) {
  //       let pageTitle = pageProps.text;
  //     }
  //   });

  // };

  return (
    <>
      <PageLayoutContext.Provider value={[dynamicPageTitle, setDynamicPageTitle]}>
        <Head>
          <title>{`XANDarch | ${pageTitle}`}</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <div className={styles.wrapper}>
          <Navbar PAGE_LINKS={PAGE_LINKS} currentRoute={currentRoute} />
          <main className={styles.main}>{children}</main>
          <GridLines />
        </div>
      </PageLayoutContext.Provider>
    </>
  );
};

export default Layout;
